library(zoo)
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
#VENTAS PRETENSA
#Analisis vendedores 2019
tabla3.1a <- venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad),
porcent_vig_eps = round((sum(vig_eps)/clientes),2),
porcent_eps = round((sum(eps)/clientes),2),
porcent_solo_ho = round((sum(no)/clientes),2),
porcent_no_indica = round(1-(porcent_vig_eps+porcent_eps+porcent_solo_ho),2))
tabla3.1b <- venta_pret %>% filter(!is.na(total_bs)) %>%
group_by(vendedor2) %>%
summarize(total_bs = sum(total_bs))
tabla3.1 <- left_join( tabla3.1a,tabla3.1b, by = "vendedor2") %>%
arrange(desc(total_bs)) %>% rename(vendedor = vendedor2)
remove(tabla3.1a, tabla3.1b)
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
ggplot(aes(x = reorder(vendedor2, volumen), y = volumen)) +
geom_col(width = 0.7, fill = "tomato2",colour="black") +
scale_y_continuous(labels = comma, breaks = seq(0, 6000, by = 1000)) +
coord_flip() + ylab("Volumen Ventas") + xlab("") + ggtitle("Total Ventas por Vendedor")
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2, gestion) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
hchart(type = "bar", hcaes(x = vendedor2, y = volumen, group = gestion)) %>%
hc_plotOptions(column = list(stacking = "normal")) %>%
hc_yAxis(
title = list(text = ""))
tabla4 <- tabla3.1 %>% select("vendedor", "clientes", "porcent_vig_eps", "porcent_eps", "porcent_solo_ho", "porcent_no_indica")
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
#VENTAS PRETENSA
#Analisis vendedores 2019
tabla3.1a <- venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad),
porcent_vig_eps = round((sum(vig_eps)/clientes),2),
porcent_eps = round((sum(eps)/clientes),2),
porcent_solo_ho = round((sum(no)/clientes),2),
porcent_no_indica = round(1-(porcent_vig_eps+porcent_eps+porcent_solo_ho),2))
tabla3.1b <- venta_pret %>% filter(!is.na(total_bs)) %>%
group_by(vendedor2) %>%
summarize(total_bs = sum(total_bs))
tabla3.1 <- left_join( tabla3.1a,tabla3.1b, by = "vendedor2") %>%
arrange(desc(total_bs)) %>% rename(vendedor = vendedor2)
remove(tabla3.1a, tabla3.1b)
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
ggplot(aes(x = reorder(vendedor2, volumen), y = volumen)) +
geom_col(width = 0.7, fill = "tomato2",colour="black") +
scale_y_continuous(labels = comma, breaks = seq(0, 6000, by = 1000)) +
coord_flip() + ylab("Volumen Ventas") + xlab("") + ggtitle("Total Ventas por Vendedor")
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2, gestion) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
hchart(type = "bar", hcaes(x = vendedor2, y = volumen, group = gestion)) %>%
hc_plotOptions(column = list(stacking = "normal")) %>%
hc_yAxis(
title = list(text = ""))
tabla4 <- tabla3.1 %>% select("vendedor", "clientes", "porcent_vig_eps", "porcent_eps", "porcent_solo_ho", "porcent_no_indica")
venta_pret %>% filter(!is.na(cantidad)) %>%
mutate(tipo_venta = ifelse(vig_eps == 1, "vig_eps",
ifelse(eps == 1, "eps",
ifelse(no == 1, "solo_ho", "no_indica")))) %>%
select("vendedor", "tipo_venta") %>%
ggplot(aes(vendedor)) +
geom_bar(aes(fill = tipo_venta), width = 0.5, colour="black") +
scale_y_continuous(breaks = seq(0,500, by = 50)) +
theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
labs(title = "Venta Productos por Vendedor")
temp <- venta_pret %>% filter(!is.na(cantidad)) %>%
mutate(tipo_venta = ifelse(vig_eps == 1, "Combo 3",
ifelse(eps == 1, "Combo 2",
ifelse(no == 1, "Combo 1", "sn_combo")))) %>%
select(vendedor = vendedor2, "tipo_venta") %>%
group_by(vendedor, tipo_venta) %>%
summarise(cantidad = n()) %>%
spread(tipo_venta, cantidad)
temp[is.na(temp)] <- 0
a_1 <- as.data.frame(temp)
categories_column <- "vendedor"
measure_columns <- c(colnames(a_1[2:length(a_1)]))
hbr_sn <- highchart() %>%
hc_xAxis(categories = a_1[, categories_column],
title = categories_column)
invisible(lapply(measure_columns, function(column) {
hbr_sn <<-
hc_add_series(hc = hbr_sn, name = column,
data = a_1[, column])
}))
hbr_sector_nivel <- hbr_sn %>%
hc_chart(type = "bar") %>%
hc_plotOptions(series = list(stacking = "normal")) %>%
hc_legend(reversed = TRUE) %>%
hc_tooltip(enabled = T, valueDecimals = 0, borderWidth = 0.01,
crosshairs = TRUE, shared = TRUE,
style = list(fontFamily = "Barlow Semi Condensed",
color = "black", fontSize = 14),
headerFormat = "<br><b>{point.key}</b><br>
<br>Total: <b>{point.total}</b><br>") %>%
hc_chart(backgroundColor="#FFFFFF", style = list(fontFamily = "Barlow Semi Condensed",
color = "black")) %>%
# hc_title(text = "Tipos de ventas completadas") %>%
hc_yAxis(
title = list(text = "Cantidad de ventas"))
hbr_sector_nivel
highchart() %>%
hc_add_series(venta_pret %>%
mutate(fecha = as.Date(fecha,"%Y-%m-%d")),
type = "scatter",
hcaes(x = cantidad, y = precio_bs_m3, group = vendedor2),
headerFormat = "",
marker = list(symbol = "circle")) %>%
hc_tooltip(pointFormat =
"<b>Volumen:<b> {point.cantidad}<br>
<b>Bs/m3:<b> {point.precio_bs_m3}<br>
<b>Cliente:<b> {point.nombre}<br>
<b>Fecha Vaciado:<b> {point.fecha}") %>%
hc_xAxis(title = list(text = "Volumen Venta")) %>%
hc_yAxis(title = list(text = "Precio Bs/m3"))
a <- venta_pret %>% filter(vendedor2 == "Vendedor 6", cantidad > 0)
venta_pret %>% select(fecha, vendedor, vendedor2, cantidad) %>%
filter(cantidad > 0, !is.na(cantidad)) %>%
filter(vendedor2 %in% c("Vendedor 4", "Vendedor 6")) %>%
hchart("line",  hcaes(x = as.Date(fecha), y = cantidad, group = vendedor2)) %>%
hc_add_series(venta_pret, "scatter", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor))
venta_pret %>% select(gestion, fecha, vendedor, vendedor2, cantidad) %>%
filter(cantidad > 0, !is.na(cantidad)) %>%
group_by(vendedor, gestion, mes = month(fecha)) %>%
mutate(suma = sum(cantidad)) %>%
ungroup() %>%
group_by(gestion, mes) %>%
mutate(promedio = mean(suma)) %>%
ungroup() %>%
mutate(fecha = as.Date(zoo::as.yearmon(fecha))) %>%
select(fecha, promedio) %>% distinct()  %>%
hchart("line",  hcaes(x = as.Date(fecha), y = promedio)) %>%
hc_add_series((venta_pret %>%
#filter(vendedor2 %in% c("Vendedor 3", "Vendedor 9")) %>%
filter(!is.na(cantidad), cantidad >0) %>%
mutate(fecha = as.Date(zoo::as.yearmon(fecha))) %>%
group_by(fecha, vendedor2) %>%
summarise(cantidad = sum(cantidad))),
"column", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor2)) %>%
hc_xAxis(
title = list(text = "")
) %>%
hc_yAxis(
title = list(text = "Volumen mensual vendido"))
hchart(a, "line", hcaes(x = as.Date(fecha), y = cantidad)) %>%
hc_add_series(venta_pret, "scatter", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor))
venta_pret %>% select(gestion, fecha, vendedor, vendedor2, cantidad) %>%
filter(cantidad > 0, !is.na(cantidad)) %>%
group_by(vendedor, gestion, mes = month(fecha)) %>%
mutate(suma = sum(cantidad)) %>%
ungroup() %>%
group_by(gestion, mes) %>%
mutate(promedio = mean(suma)) %>%
ungroup() %>%
mutate(fecha = as.Date(zoo::as.yearmon(fecha))) %>%
select(fecha, promedio) %>% distinct()  %>%
hchart("line",  hcaes(x = as.Date(fecha), y = promedio)) %>%
hc_add_series((venta_pret %>%
#filter(vendedor2 %in% c("Vendedor 3", "Vendedor 9")) %>%
filter(!is.na(cantidad), cantidad >0) %>%
mutate(fecha = as.Date(zoo::as.yearmon(fecha))) %>%
group_by(fecha, vendedor2) %>%
summarise(cantidad = sum(cantidad))),
"column", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor2)) %>%
hc_xAxis(
title = list(text = "")
) %>%
hc_yAxis(
title = list(text = "Volumen mensual vendido"))
venta_pret %>% select(fecha, vendedor, vendedor2, cantidad) %>%
filter(cantidad > 0, !is.na(cantidad)) %>%
filter(vendedor2 %in% c("Vendedor 4", "Vendedor 6")) %>%
hchart("line",  hcaes(x = as.Date(fecha), y = cantidad, group = vendedor2)) %>%
hc_add_series(venta_pret, "scatter", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor))
hchart(a, "line", hcaes(x = as.Date(fecha), y = cantidad)) %>%
hc_add_series(venta_pret, "scatter", hcaes(x = as.Date(fecha), y = cantidad, group = vendedor))
highchart() %>%
hc_add_series(venta_pret %>%
mutate(fecha = as.Date(fecha,"%Y-%m-%d")),
type = "scatter",
hcaes(x = cantidad, y = precio_bs_m3, group = vendedor2),
headerFormat = "",
marker = list(symbol = "circle")) %>%
hc_tooltip(pointFormat =
"<b>Volumen:<b> {point.cantidad}<br>
<b>Bs/m3:<b> {point.precio_bs_m3}<br>
<b>Cliente:<b> {point.nombre}<br>
<b>Fecha Vaciado:<b> {point.fecha}") %>%
hc_xAxis(title = list(text = "Volumen Venta")) %>%
hc_yAxis(title = list(text = "Precio Bs/m3"))
hbr_sector_nivel
margen %>% group_by(mes = month(fecha), gestion =year(fecha)) %>%
summarise(`Precio por m3` = mean(precio_bs_m3),
`Costo por m3` = mean(costo_total_bs_m3),
`Margen por m3` = mean(margen_bs_m3))
avg_mes %>% ggplot(aes(x = as.Date(as.yearmon(avg_mes$mes_year)), y = margen_bruto_bs )) +
geom_line(color="steelblue") +
geom_point() +
scale_x_date(date_breaks = "months" , date_labels = "%b-%y") +
scale_y_continuous(labels = comma, breaks = seq(0, 700000, by = 100000)) +
# theme_ipsum() +
theme(axis.text.x = element_text(angle = 90)) +
xlab("Fecha") + ylab("Bs") +
ggtitle("Margen Bruto Bs")
hchart(margen %>% group_by(fecha) %>%
summarise(`Precio total` = sum(precio_total_venta_bs),
`Costo total` = sum(costo_total_bs),
`Margen` = `Precio total`-`Costo total`) %>%
mutate(`Costo total` = (-`Costo total`)) %>%
gather(tipo, valor, -fecha) %>%
arrange(fecha),
"line",
hcaes(x = as.Date(fecha), y = valor, group = tipo)) %>%
hc_colors(c("#ee4035" ,"#0392cf", "#7bc043")) %>%
hc_yAxis(title = list(text = "Valor en Bs.")) %>%
hc_xAxis(title = list(text = ""))
hchart(margen %>% group_by(fecha) %>%
summarise(`Precio por m3` = mean(precio_bs_m3),
`Costo por m3` = mean(costo_total_bs_m3),
`Margen por m3` = mean(margen_bs_m3)) %>%
mutate(`Costo por m3` = (-`Costo por m3`)) %>%
gather(tipo, valor, -fecha) %>%
arrange(fecha),
"line",
hcaes(x = as.Date(fecha), y = valor, group = tipo)) %>%
hc_colors(c("#ee4035" ,"#0392cf", "#7bc043")) %>%
hc_yAxis(title = list(text = "Valor en Bs. por m3")) %>%
hc_xAxis(title = list(text = ""))
venta_pret
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
ggplot(aes(x = reorder(vendedor2, volumen), y = volumen)) +
geom_col(width = 0.7, fill = "tomato2",colour="black") +
scale_y_continuous(labels = comma, breaks = seq(0, 6000, by = 1000)) +
coord_flip() + ylab("Volumen Ventas") + xlab("") + ggtitle("Total Ventas por Vendedor")
venta_pret %>% filter(!is.na(cantidad)) %>%
group_by(vendedor2, gestion) %>%
summarize(clientes = unique(n()),
volumen = sum(cantidad)) %>%
hchart(type = "bar", hcaes(x = vendedor2, y = volumen, group = gestion)) %>%
hc_plotOptions(column = list(stacking = "normal")) %>%
hc_yAxis(
title = list(text = ""))
venta_pret
names(venta_pret)
unique(venta_pret$zona)
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
unique(venta_pret$zona)
temp <- venta_pret %>% filter(!is.na(cantidad)) %>%
mutate(tipo_venta = ifelse(vig_eps == 1, "Combo 3",
ifelse(eps == 1, "Combo 2",
ifelse(no == 1, "Combo 1", "sn_combo")))) %>%
select(vendedor = vendedor2, "tipo_venta") %>%
group_by(vendedor, tipo_venta) %>%
summarise(cantidad = n()) %>%
spread(tipo_venta, cantidad)
temp
venta_pret
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret
df <- rio::import("muestras/input/base_limpia.xlsx")
df <- rio::import("input/base_limpia.xlsx")
conflictos <- df %>%
mutate(year = lubridate::year(fecha))
temp <- conflictos %>% mutate(gestion = lubridate::year(fecha)) %>%
filter(gestion >= 2010) %>%
select(id, tipo, medida_de_presion) %>%
group_by(tipo, medida_de_presion) %>%
summarise(frecuencia = n()) %>%
filter(tipo != "Otro") %>%
spread(medida_de_presion, frecuencia) %>%
mutate_if(is.numeric, replace_na, 0) %>%
gather(medida_de_presion, frecuencia, -tipo)
temp
temp <- temp %>% group_by(tipo) %>%
mutate(total = sum(frecuencia)) %>%
ungroup() %>%
filter(total > 200) %>%
group_by(medida_de_presion) %>%
mutate(total = sum(frecuencia)) %>%
ungroup() %>%
filter(total > 200) %>% select(-total)
temp
temp <- left_join(left_join(temp, data.frame(tipo = unique(temp$tipo), vendedor = c(1:length(unique(temp$tipo))))) %>%
mutate(tipo = paste0("Vendedor ", vendedor)) %>% select(-vendedor),
data.frame(medida_de_presion = unique(temp$medida_de_presion), barrio = c(1:length(unique(temp$medida_de_presion))))) %>%
mutate(medida_de_presion = paste0("Barrio ", barrio)) %>% select(-barrio)
temp
ventas
venta_pret
venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n())
hchart(temp,
"heatmap",
hcaes(
x = medida_de_presion,
y = tipo,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800) -> heat_tipo_med
heat_tipo_med
head(venta_pret)
temp <- venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n())
hchart(temp,
"heatmap",
hcaes(
x = medida_de_presion,
y = tipo,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800) -> heat_tipo_med
hchart(temp,
"heatmap",
hcaes(
x = zona,
y = vendedor,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800) -> heat_tipo_med
temp <- venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n())
hchart(temp,
"heatmap",
hcaes(
x = zona,
y = vendedor2,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800) -> heat_tipo_med
heat_tipo_med
venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n())
venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n()) %>%
spread(vendedor2, frecuencia)
venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n()) %>%
spread(vendedor2, frecuencia) %>%
mutate_if(is.numeric, replace_na, 0)
venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n()) %>%
spread(vendedor2, frecuencia) %>%
mutate_if(is.numeric, replace_na, 0) %>%
gather(vendedor2, frecuencia, -zona)
temp <- venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n()) %>%
spread(vendedor2, frecuencia) %>%
mutate_if(is.numeric, replace_na, 0) %>%
gather(vendedor2, frecuencia, -zona)
hchart(temp,
"heatmap",
hcaes(
x = zona,
y = vendedor2,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800) -> heat_tipo_med
heat_tipo_med
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
names(venta_pret)
venta_pret <-  rio::import("input/vendedores_pret.xlsx")
venta_pret <- venta_pret %>% mutate(gestion = year(fecha)) %>%
filter(!vendedor %in% c("Carlos Taborga", "Vladimir Gálvez"), gestion != 2009)
hchart(venta_pret %>% group_by(vendedor2, zona) %>%
summarise(frecuencia = n()) %>%
spread(vendedor2, frecuencia) %>%
mutate_if(is.numeric, replace_na, 0) %>%
gather(vendedor2, frecuencia, -zona),
"heatmap",
hcaes(
x = zona,
y = vendedor2,
value = frecuencia
)) %>%
hc_colorAxis(
stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
) %>%
hc_chart(backgroundColor="white", borderColor = "transparent",
style=list(fontFamily = "Oswald", fontSize = 12)) %>%
hc_yAxis(mayorGridLineWidth = 1,
gridLineColor = "white",
title = list(
text = "Nombre Vendedor")) %>%
hc_xAxis(mayorGridLineWidth = 1,
minorGridLineWidth = 5,
gridLineColor = "white",
title = list(text = "Nombre del Barrio")) %>%
hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01,
style = list(fontFamily = "Oswald"),
pointFormat=paste("
<b>{point.frecuencia}</b> productos cerrados<br>"),
headerFormat = "") %>%
hc_size(height = 800)
